- 계정 생성 및 권한 부여

conn /as sysdba

create user kosta identified by 1234;

grant connect, resource, dba to kosta;

commit;

-- 테이블 생성
-- 지역
CREATE TABLE LOCATIONS (
    NO                  NUMBER                  PRIMARY KEY,
    NAME                VARCHAR2(100)           UNIQUE
);

-- 관심사
CREATE TABLE FAVORITES (
    NO                  NUMBER                  PRIMARY KEY,
    NAME                VARCHAR2(100)           NOT NULL,
    HEART               NUMBER                  DEFAULT 0
);

-- 회원
CREATE TABLE MEMBERS (
    NO                  NUMBER                  PRIMARY KEY,
    ID                  VARCHAR2(100)           UNIQUE,
    PWD                 VARCHAR2(100)           NOT NULL,
    NAME                VARCHAR2(100)           NOT NULL,
    EMAIL               VARCHAR2(100)           NOT NULL,
    JOIN_DATE           DATE                    DEFAULT SYSDATE,
    ADMIN               CHAR(1)                 DEFAULT '0',                    
    
    -- FK
    LOCATIONS_NO         NUMBER,
    FAVORITES_NO         NUMBER,
    
    -- 제약조건
    CONSTRAINT FK_LOCATIONS_NO FOREIGN KEY(LOCATIONS_NO) REFERENCES LOCATIONS(NO),
    CONSTRAINT FK_FAVORITES_NO FOREIGN KEY(FAVORITES_NO) REFERENCES FAVORITES(NO)
);

-- 게시판
CREATE TABLE ARTICLES (
    NO                  NUMBER                 PRIMARY KEY,
    TITLE               VARCHAR2(100)          NOT NULL,
    CONTENT             VARCHAR2(100)          NOT NULL,
    HEART               NUMBER                 DEFAULT 0,
    W_DATE              DATE                   DEFAULT SYSDATE,
    E_DATE              DATE                   DEFAULT SYSDATE,

    -- FK
    MEMBERS_NO          NUMBER,
    FAVORITES_NO        NUMBER,

    -- 제약조건  
    CONSTRAINT FK_MEMBERS_NO FOREIGN KEY(MEMBERS_NO) REFERENCES MEMBERS(NO) ON DELETE SET NULL,
    FOREIGN KEY(FAVORITES_NO) REFERENCES FAVORITES(NO)
);

-- 댓글
CREATE TABLE REPLIES (
    NO                  NUMBER                  PRIMARY KEY,
    CONTENT             VARCHAR2(100)           NOT NULL,
    W_DATE              DATE                    DEFAULT SYSDATE,
    E_DATE              DATE                    DEFAULT SYSDATE,
    HEART               NUMBER                  DEFAULT 0,

    -- FK
    ARTICLES_NO         NUMBER,
    MEMBERS_NO          NUMBER,
    
    -- 제약조건
    CONSTRAINT FK_ARTICLES_NO FOREIGN KEY(ARTICLES_NO) REFERENCES ARTICLES(NO),
    FOREIGN KEY(MEMBERS_NO) REFERENCES MEMBERS(NO) ON DELETE SET NULL
);

-- 모집
CREATE TABLE MEETS (
    NO                  NUMBER                  PRIMARY KEY,
    RECURIT             NUMBER                  DEFAULT 1,
    TITLE               VARCHAR2(100)           NOT NULL,
    CONTENT             VARCHAR2(100)           NOT NULL,
    W_DATE              DATE                    DEFAULT SYSDATE,
    E_DATE              DATE                    DEFAULT SYSDATE,
    DEADLINE            DATE                    NOT NULL,

    -- FK
    LOCATIONS_NO         NUMBER,
    MEMBERS_NO           NUMBER,
    
    -- 제약조건
    FOREIGN KEY(LOCATION_NO) REFERENCES LOCATIONS(NO),
    FOREIGN KEY(MEMBER_NO) REFERENCES MEMBERS(NO)
);

CREATE TABLE MEETS_REPLIES (
    NO                  NUMBER                  PRIMARY KEY,
    CONTENT             VARCHAR2(100)           NOT NULL,
    W_DATE              DATE                    DEFAULT SYSDATE,
    E_DATE              DATE                    DEFAULT SYSDATE,
    IN_REPLY            NUMBER                  DEFAULT 0,

    -- FK
    MEETS_NO         NUMBER,
    MEMBERS_NO       NUMBER,
    
    -- 제약조건
    CONSTRAINT FK_MEETS_NO FOREIGN KEY(MEETS_NO) REFERENCES MEETS(NO),
    FOREIGN KEY(MEMBERS_NO) REFERENCES MEMBERS(NO) ON DELETE SET NULL
);

CREATE TABLE ARTICLES_LIKE (
    MEMBERS_NO           NUMBER                  NOT NULL,
    ARTICLES_NO          NUMBER                  NOT NULL,
    
    FOREIGN KEY(MEMBERS_NO) REFERENCES MEMBERS(NO),
    FOREIGN KEY(ARTICLES_NO) REFERENCES ARTICLES(NO)
);

CREATE TABLE REPLIES_LIKE (
    MEMBERS_NO           NUMBER                  NOT NULL,
    ARTICLES_NO          NUMBER                  NOT NULL,
    REPLIES_NO           NUMBER                  NOT NULL,
        
    FOREIGN KEY(MEMBERS_NO) REFERENCES MEMBERS(NO),
    FOREIGN KEY(ARTICLES_NO) REFERENCES ARTICLES(NO),
    CONSTRAINT FK_REPLIES_NO FOREIGN KEY(REPLIES_NO) REFERENCES REPLIES(NO)
);

CREATE TABLE MEETS_RECURIT_LIKE (
    MEETS_NO                NUMBER,
    MEMBERS_NO              NUMBER,
    CANCEL                  NUMBER(1)               CHECK(CANCEL('0', '1')),
);

-- 테이블별 NO 시퀀스
CREATE SEQUENCE ARTICLES_NO_SEQUENCE;

CREATE SEQUENCE MEMBERS_NO_SEQUENCE;

CREATE SEQUENCE REPLIES_NO_SEQUENCE;

CREATE SEQUENCE MEETS_NO_SEQUENCE;

-- 임시 데이터
INSERT INTO LOCATIONS VALUES(1, '서울특별시');
INSERT INTO LOCATIONS VALUES(2, '경기도');
INSERT INTO LOCATIONS VALUES(3, '강원도');
INSERT INTO LOCATIONS VALUES(4, '충청도');
INSERT INTO LOCATIONS VALUES(5, '전라도');
INSERT INTO LOCATIONS VALUES(6, '경상도');

INSERT INTO FAVORITES(NO, NAME) VALUES(1, '운동');
INSERT INTO FAVORITES(NO, NAME) VALUES(2, '요리');
INSERT INTO FAVORITES(NO, NAME) VALUES(3, '공부');
INSERT INTO FAVORITES(NO, NAME) VALUES(4, '독서');
INSERT INTO FAVORITES(NO, NAME) VALUES(5, '음악');

INSERT INTO MEMBERS VALUES(MEMBERS_NO_SEQUENCE.NEXTVAL, 'AAA', '12', '철수', 'aaa@gmail.com', SYSDATE, 0, 1, 3);
INSERT INTO MEMBERS VALUES(MEMBERS_NO_SEQUENCE.NEXTVAL, 'AAB', '121', '영자', 'aab@gmail.com', SYSDATE, 0, 3, 2);
INSERT INTO MEMBERS VALUES(MEMBERS_NO_SEQUENCE.NEXTVAL, 'AAC', '122', '옥자', 'aac@gmail.com', SYSDATE, 0, 2, 5);
INSERT INTO MEMBERS VALUES(MEMBERS_NO_SEQUENCE.NEXTVAL, 'BBA', '21', '마빡', 'bba@gmail.com', SYSDATE, 0, 5, 4);
INSERT INTO MEMBERS VALUES(MEMBERS_NO_SEQUENCE.NEXTVAL, 'BBB', '211', '맹구', 'bbb@gmail.com', SYSDATE, 0, 4, 3);
INSERT INTO MEMBERS VALUES(MEMBERS_NO_SEQUENCE.NEXTVAL, 'BBC', '212', '유리', 'bbc@gmail.com', SYSDATE, 0, 2, 2);
INSERT INTO MEMBERS VALUES(MEMBERS_NO_SEQUENCE.NEXTVAL, 'CCA', '31', '하마', 'cca@gmail.com', SYSDATE, 0, 3, 1);
INSERT INTO MEMBERS VALUES(MEMBERS_NO_SEQUENCE.NEXTVAL, 'CCB', '311', '탱고', 'ccb@gmail.com', SYSDATE, 0, 5, 5);
INSERT INTO MEMBERS VALUES(MEMBERS_NO_SEQUENCE.NEXTVAL, 'CCC', '312', '천수', 'ccc@gmail.com', SYSDATE, 0, 6, 2);

INSERT INTO ARTICLES VALUES(ARTICLES_NO_SEQUENCE.NEXTVAL, 'hello', 'world', 0, sysdate, sysdate, 1, 5);
INSERT INTO ARTICLES VALUES(ARTICLES_NO_SEQUENCE.NEXTVAL, 'my', 'world', 0, sysdate, sysdate, 3, 2);
INSERT INTO ARTICLES VALUES(ARTICLES_NO_SEQUENCE.NEXTVAL, 'your', 'world', 0, sysdate, sysdate, 4, 1);
INSERT INTO ARTICLES VALUES(ARTICLES_NO_SEQUENCE.NEXTVAL, 'her', 'world', 0, sysdate, sysdate, 2, 4);
INSERT INTO ARTICLES VALUES(ARTICLES_NO_SEQUENCE.NEXTVAL, 'him', 'world', 0, sysdate, sysdate, 6, 3);
INSERT INTO ARTICLES VALUES(ARTICLES_NO_SEQUENCE.NEXTVAL, 'girls', 'world', 0, sysdate, sysdate, 7, 2);
INSERT INTO ARTICLES VALUES(ARTICLES_NO_SEQUENCE.NEXTVAL, 'boys', 'world', 0, sysdate, sysdate, 2, 4);
INSERT INTO ARTICLES VALUES(ARTICLES_NO_SEQUENCE.NEXTVAL, 'aunt', 'world', 0, sysdate, sysdate, 1, 1);
INSERT INTO ARTICLES VALUES(ARTICLES_NO_SEQUENCE.NEXTVAL, 'uncle', 'world', 0, sysdate, sysdate, 4, 1);

INSERT INTO REPLIES VALUES(REPLIES_NO_SEQUENCE.NEXTVAL, '야이씨', SYSDATE, SYSDATE, 0, 1, 3);
INSERT INTO REPLIES VALUES(REPLIES_NO_SEQUENCE.NEXTVAL, '저이씨', SYSDATE, SYSDATE, 0, 4, 2);
INSERT INTO REPLIES VALUES(REPLIES_NO_SEQUENCE.NEXTVAL, '상놈의씨', SYSDATE, SYSDATE, 0, 3, 1);
INSERT INTO REPLIES VALUES(REPLIES_NO_SEQUENCE.NEXTVAL, '개노무씨', SYSDATE, SYSDATE, 0, 5, 1);
INSERT INTO REPLIES VALUES(REPLIES_NO_SEQUENCE.NEXTVAL, '이자슥씨', SYSDATE, SYSDATE, 0, 7, 5);
INSERT INTO REPLIES VALUES(REPLIES_NO_SEQUENCE.NEXTVAL, '오함마씨', SYSDATE, SYSDATE, 0, 9, 6);
INSERT INTO REPLIES VALUES(REPLIES_NO_SEQUENCE.NEXTVAL, '장도리씨', SYSDATE, SYSDATE, 0, 4, 4);
INSERT INTO REPLIES VALUES(REPLIES_NO_SEQUENCE.NEXTVAL, '어린노무자슥', SYSDATE, SYSDATE, 5, 1, 8);
INSERT INTO REPLIES VALUES(REPLIES_NO_SEQUENCE.NEXTVAL, '이노무자슥', SYSDATE, SYSDATE, 0, 6, 1);

INSERT INTO MEETS VALUES(MEETS_NO_SEQUENCE.NEXTVAL, 4, '데스윙팟4인', '4인급구', SYSDATE, SYSDATE, '2023/09/10', 3, 1);
INSERT INTO MEETS VALUES(MEETS_NO_SEQUENCE.NEXTVAL, 10, '데스윙팟10인', '10인급구', SYSDATE, SYSDATE, '2023/09/11', 2, 2);
INSERT INTO MEETS VALUES(MEETS_NO_SEQUENCE.NEXTVAL, 2, '데스윙팟2인', '2인급구', SYSDATE, SYSDATE, '2023/09/12', 1, 7);
INSERT INTO MEETS VALUES(MEETS_NO_SEQUENCE.NEXTVAL, 8, '데스윙팟8인', '8인급구', SYSDATE, SYSDATE, '2023/09/13', 5, 4);
INSERT INTO MEETS VALUES(MEETS_NO_SEQUENCE.NEXTVAL, 21, '데스윙팟21인', '21인급구', SYSDATE, SYSDATE, '2023/09/14', 4, 5);
INSERT INTO MEETS VALUES(MEETS_NO_SEQUENCE.NEXTVAL, 9, '데스윙팟9인', '9인급구', SYSDATE, SYSDATE, '2023/09/10', 1, 5);
INSERT INTO MEETS VALUES(MEETS_NO_SEQUENCE.NEXTVAL, 4, '데스윙팟4인', '4인급구', SYSDATE, SYSDATE, '2023/09/12', 5, 8);
INSERT INTO MEETS VALUES(MEETS_NO_SEQUENCE.NEXTVAL, 6, '데스윙팟6인', '6인급구', SYSDATE, SYSDATE, '2023/09/13', 4, 4);
INSERT INTO MEETS VALUES(MEETS_NO_SEQUENCE.NEXTVAL, 2, '데스윙팟2인', '2인급구', SYSDATE, SYSDATE, '2023/09/11', 6, 3);

CREATE SEQUENCE MEETS_REPLIES_NO_SEQUENCE;

INSERT INTO MEETS_REPLIES VALUES(MEETS_REPLIES_NO_SEQUENCE.NEXTVAL, 'AAA', SYSDATE, SYSDATE, 0, 1, 1);
INSERT INTO MEETS_REPLIES VALUES(MEETS_REPLIES_NO_SEQUENCE.NEXTVAL, 'BBB', SYSDATE, SYSDATE, 0, 1, 2);
INSERT INTO MEETS_REPLIES VALUES(MEETS_REPLIES_NO_SEQUENCE.NEXTVAL, 'CCC', SYSDATE, SYSDATE, 0, 1, 3);

COMMIT;